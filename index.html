<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YumInfo - 상품 정보 음성 안내</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        
        .speaking {
            background: linear-gradient(45deg, #10b981, #059669);
            animation: speaking-pulse 1s infinite;
        }
        
        @keyframes speaking-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.5); }
            50% { box-shadow: 0 0 30px rgba(16, 185, 129, 0.8); }
        }

        .info-card {
            transition: all 0.3s ease;
        }

        .info-card:active {
            transform: scale(0.95);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    
    <!-- 메인 페이지 -->
    <div id="mainPage" class="page active">
        <div class="container mx-auto px-4 py-6 max-w-md">
            <!-- 헤더 -->
            <div class="text-center mb-6">
                <h1 class="text-2xl font-bold text-gray-800 mb-2">🔊 YumInfo</h1>
                <h2 class="text-xl font-semibold text-gray-700" id="productName">진라면 매운맛</h2>
                <p class="text-gray-600">120g (컵라면)</p>
            </div>

            <!-- 4칸 그리드 레이아웃 -->
            <div class="grid grid-cols-2 gap-6 mb-8">
                <!-- 유통기한 -->
                <div class="info-card bg-white rounded-3xl shadow-xl p-8 border-l-4 border-red-500 cursor-pointer" onclick="showDetailPage('expiry')">
                    <div class="text-center">
                        <div class="text-5xl mb-4">⏰</div>
                        <h3 class="text-lg font-bold text-red-700 mb-3">유통기한</h3>
                        <p class="text-xl font-bold text-red-800" id="expiryDate">2025.12.15</p>
                    </div>
                </div>

                <!-- 원재료명 -->
                <div class="info-card bg-white rounded-3xl shadow-xl p-8 border-l-4 border-blue-500 cursor-pointer" onclick="showDetailPage('ingredients')">
                    <div class="text-center">
                        <div class="text-5xl mb-4">📋</div>
                        <h3 class="text-lg font-bold text-blue-700 mb-3">원재료명</h3>
                        <p class="text-base font-semibold text-blue-800" id="ingredients">면(밀가루, 팜유)<br>스프(고춧가루, 마늘)</p>
                    </div>
                </div>

                <!-- 영양정보 -->
                <div class="info-card bg-white rounded-3xl shadow-xl p-8 border-l-4 border-green-500 cursor-pointer" onclick="showDetailPage('nutrition')">
                    <div class="text-center">
                        <div class="text-5xl mb-4">📊</div>
                        <h3 class="text-lg font-bold text-green-700 mb-3">영양정보</h3>
                        <div class="text-sm text-green-800" id="nutrition">
                            <div>칼로리 510kcal</div>
                            <div>단백질 9.8g</div>
                            <div>지방 19.2g</div>
                        </div>
                    </div>
                </div>

                <!-- 주의사항 -->
                <div class="info-card bg-white rounded-3xl shadow-xl p-8 border-l-4 border-yellow-500 cursor-pointer" onclick="showDetailPage('warning')">
                    <div class="text-center">
                        <div class="text-5xl mb-4">⚠️</div>
                        <h3 class="text-lg font-bold text-yellow-700 mb-3">주의사항</h3>
                        <p class="text-sm font-semibold text-yellow-800" id="warning">직사광선 피해 보관<br>뜨거운 물 주의<br>알레르기: 밀, 대두</p>
                    </div>
                </div>
            </div>

            <!-- 중앙 재생/정지 버튼 -->
            <div class="flex justify-center mb-6">
                <button id="mainPlayBtn" class="bg-blue-600 hover:bg-blue-700 text-white w-20 h-20 rounded-full font-bold text-lg transition-all duration-300 flex items-center justify-center shadow-2xl transform hover:scale-105">
                    <svg id="playIcon" class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1.586a1 1 0 01.707.293l2.414 2.414a1 1 0 00.707.293H15M9 10v4m0-4h6m0 0v4m0-4h.5a2.5 2.5 0 012.5 2.5v1a2.5 2.5 0 01-2.5 2.5H15"></path>
                    </svg>
                    <svg id="stopIcon" class="w-10 h-10 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10h6v4H9z"></path>
                    </svg>
                </button>
            </div>

            <!-- 전체 정보 보기 버튼 -->
            <div class="mb-6">
                <button onclick="showDetailPage('all')" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-4 rounded-2xl font-bold text-lg transition-all duration-300 shadow-lg transform hover:scale-105">
                    📋 전체 정보 보기
                </button>
            </div>

            <!-- 음성 상태 표시 -->
            <div id="speakingIndicator" class="hidden mb-6">
                <div class="flex items-center justify-center space-x-3 text-green-600 text-lg bg-white rounded-2xl p-4 shadow-lg">
                    <div class="w-4 h-4 bg-green-500 rounded-full pulse-animation"></div>
                    <span class="font-bold">🎵 음성 안내 중...</span>
                </div>
            </div>

            <!-- 음성인식 상태 표시 -->
            <div id="listeningIndicator" class="hidden mb-6">
                <div class="flex items-center justify-center space-x-3 text-blue-600 text-lg bg-white rounded-2xl p-4 shadow-lg border-2 border-blue-200">
                    <div class="w-4 h-4 bg-blue-500 rounded-full pulse-animation"></div>
                    <span class="font-bold">🎤 음성 인식 중... "얌인포"라고 불러주세요</span>
                </div>
            </div>

            <!-- 음성인식 테스트 버튼 -->
            <div class="mb-6 space-y-3">
                <button onclick="testMicrophone()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-2xl font-bold text-base transition-all duration-300 shadow-lg">
                    🎤 마이크 테스트
                </button>
                <button onclick="restartListening()" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-2xl font-bold text-base transition-all duration-300 shadow-lg">
                    🔄 음성인식 다시 시작
                </button>
                <div id="microphoneStatus" class="text-center text-sm text-gray-600 hidden">
                    <p>마이크 상태를 확인 중...</p>
                </div>
            </div>

            <!-- 음성 속도 조절 -->
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                <label class="block text-lg font-bold text-gray-700 mb-3 text-center">음성 속도 조절</label>
                <input type="range" id="speedControl" min="0.6" max="1.0" step="0.1" value="0.8" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                <div class="flex justify-between text-sm text-gray-500 mt-2 font-medium">
                    <span>🐌 느림 (0.6)</span>
                    <span>⚡ 보통 (0.8)</span>
                    <span>🚀 빠름 (1.0)</span>
                </div>
                <div class="text-center mt-2">
                    <span id="speedValue" class="text-sm font-bold text-blue-600">현재: 0.8배속</span>
                </div>
            </div>

            <!-- 접근성 안내 -->
            <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200 mb-4">
                <div class="flex items-start">
                    <svg class="w-5 h-5 text-yellow-600 mr-2 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div>
                        <p class="text-sm text-yellow-800 font-medium">💡 사용법</p>
                        <p class="text-xs text-yellow-700 mt-1">각 정보 칸을 터치하면 상세 정보를 볼 수 있어요. 가운데 버튼으로 전체 정보를 들어보세요.</p>
                    </div>
                </div>
            </div>

            <!-- 음성인식 안내 -->
            <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                <div class="flex items-start">
                    <svg class="w-5 h-5 text-blue-600 mr-2 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                    </svg>
                    <div>
                        <p class="text-sm text-blue-800 font-medium">🎤 음성 명령 사용법</p>
                        <p class="text-xs text-blue-700 mt-1"><strong>1단계:</strong> 위의 "마이크 테스트" 버튼을 먼저 눌러보세요</p>
                        <p class="text-xs text-blue-700 mt-1"><strong>2단계:</strong> 마이크 권한을 허용해주세요</p>
                        <p class="text-xs text-blue-700 mt-1"><strong>3단계:</strong> "얌인포, 유통기한 알려줘" 같이 말해보세요</p>
                        <p class="text-xs text-blue-700 mt-1"><strong>💡 팁:</strong> 조용한 곳에서 또렷하게 말해주세요</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 유통기한 상세 페이지 -->
    <div id="expiryPage" class="page">
        <div class="container mx-auto px-4 py-6 max-w-md">
            <div class="flex items-center mb-6">
                <button onclick="showMainPage()" class="mr-4 p-2 rounded-full bg-white shadow-lg">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <h1 class="text-2xl font-bold text-gray-800">⏰ 유통기한</h1>
            </div>

            <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4">⏰</div>
                    <h2 class="text-3xl font-bold text-red-800 mb-4">2025년 12월 15일</h2>
                    <p class="text-lg text-gray-600">까지 섭취 가능</p>
                </div>

                <div class="space-y-4">
                    <div class="bg-red-50 p-4 rounded-xl">
                        <h3 class="font-bold text-red-700 mb-2">📅 제조일자</h3>
                        <p class="text-red-800">2024년 12월 10일</p>
                    </div>
                    
                    <div class="bg-red-50 p-4 rounded-xl">
                        <h3 class="font-bold text-red-700 mb-2">⚡ 유통기한 안내</h3>
                        <p class="text-red-800">제조일로부터 1년간 보관 가능합니다.</p>
                    </div>

                    <div class="bg-yellow-50 p-4 rounded-xl">
                        <h3 class="font-bold text-yellow-700 mb-2">💡 보관 팁</h3>
                        <p class="text-yellow-800">직사광선을 피해 서늘하고 건조한 곳에 보관하세요.</p>
                    </div>
                </div>

                <button onclick="speakDetailSection('expiry')" class="w-full mt-6 bg-red-600 hover:bg-red-700 text-white py-4 rounded-2xl font-bold text-lg transition-all duration-300 shadow-lg">
                    🔊 음성으로 듣기
                </button>
            </div>
        </div>
    </div>

    <!-- 원재료 상세 페이지 -->
    <div id="ingredientsPage" class="page">
        <div class="container mx-auto px-4 py-6 max-w-md">
            <div class="flex items-center mb-6">
                <button onclick="showMainPage()" class="mr-4 p-2 rounded-full bg-white shadow-lg">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <h1 class="text-2xl font-bold text-gray-800">📋 원재료명</h1>
            </div>

            <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4">🥛</div>
                    <h2 class="text-2xl font-bold text-blue-800 mb-4">면과 스프</h2>
                    <p class="text-lg text-gray-600">(국내산 밀가루 사용)</p>
                </div>

                <div class="space-y-4">
                    <div class="bg-blue-50 p-4 rounded-xl">
                        <h3 class="font-bold text-blue-700 mb-2">🍜 면</h3>
                        <p class="text-blue-800">밀가루(국내산), 팜유, 정제염, 산도조절제가 들어있습니다.</p>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-xl">
                        <h3 class="font-bold text-blue-700 mb-2">🌶️ 스프</h3>
                        <p class="text-blue-800">고춧가루, 마늘, 양파, 파, 후추 등의 향신료가 포함되어 있습니다.</p>
                    </div>

                    <div class="bg-green-50 p-4 rounded-xl">
                        <h3 class="font-bold text-green-700 mb-2">✨ 특징</h3>
                        <p class="text-green-800">매콤하고 진한 국물맛이 일품인 대표적인 한국 라면입니다.</p>
                    </div>
                </div>

                <button onclick="speakDetailSection('ingredients')" class="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-2xl font-bold text-lg transition-all duration-300 shadow-lg">
                    🔊 음성으로 듣기
                </button>
            </div>
        </div>
    </div>

    <!-- 영양정보 상세 페이지 -->
    <div id="nutritionPage" class="page">
        <div class="container mx-auto px-4 py-6 max-w-md">
            <div class="flex items-center mb-6">
                <button onclick="showMainPage()" class="mr-4 p-2 rounded-full bg-white shadow-lg">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <h1 class="text-2xl font-bold text-gray-800">📊 영양정보</h1>
            </div>

            <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4">📊</div>
                    <h2 class="text-xl font-bold text-green-800 mb-4">1개(120g)당 영양성분</h2>
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between items-center bg-green-50 p-4 rounded-xl">
                        <span class="font-bold text-green-700">칼로리</span>
                        <span class="font-bold text-green-800 text-xl">510kcal</span>
                    </div>
                    <div class="flex justify-between items-center bg-green-50 p-4 rounded-xl">
                        <span class="font-bold text-green-700">단백질</span>
                        <span class="font-bold text-green-800 text-xl">9.8g</span>
                    </div>
                    <div class="flex justify-between items-center bg-green-50 p-4 rounded-xl">
                        <span class="font-bold text-green-700">지방</span>
                        <span class="font-bold text-green-800 text-xl">19.2g</span>
                    </div>
                    <div class="flex justify-between items-center bg-green-50 p-4 rounded-xl">
                        <span class="font-bold text-green-700">탄수화물</span>
                        <span class="font-bold text-green-800 text-xl">72.1g</span>
                    </div>
                    <div class="flex justify-between items-center bg-green-50 p-4 rounded-xl">
                        <span class="font-bold text-green-700">나트륨</span>
                        <span class="font-bold text-green-800 text-xl">1790mg</span>
                    </div>
                    <div class="flex justify-between items-center bg-green-50 p-4 rounded-xl">
                        <span class="font-bold text-green-700">당류</span>
                        <span class="font-bold text-green-800 text-xl">5.2g</span>
                    </div>
                </div>

                <button onclick="speakDetailSection('nutrition')" class="w-full mt-6 bg-green-600 hover:bg-green-700 text-white py-4 rounded-2xl font-bold text-lg transition-all duration-300 shadow-lg">
                    🔊 음성으로 듣기
                </button>
            </div>
        </div>
    </div>

    <!-- 주의사항 상세 페이지 -->
    <div id="warningPage" class="page">
        <div class="container mx-auto px-4 py-6 max-w-md">
            <div class="flex items-center mb-6">
                <button onclick="showMainPage()" class="mr-4 p-2 rounded-full bg-white shadow-lg">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <h1 class="text-2xl font-bold text-gray-800">⚠️ 주의사항</h1>
            </div>

            <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4">⚠️</div>
                    <h2 class="text-xl font-bold text-yellow-800 mb-4">보관 및 섭취 주의사항</h2>
                </div>

                <div class="space-y-4">
                    <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-yellow-500">
                        <h3 class="font-bold text-yellow-700 mb-2">📦 보관방법</h3>
                        <p class="text-yellow-800">직사광선을 피해 서늘하고 건조한 곳에 보관해주세요.</p>
                    </div>
                    
                    <div class="bg-red-50 p-4 rounded-xl border-l-4 border-red-500">
                        <h3 class="font-bold text-red-700 mb-2">🔥 조리 시 주의</h3>
                        <p class="text-red-800">끓는 물에 화상을 입지 않도록 주의하세요. 어린이는 보호자와 함께 조리하세요.</p>
                    </div>

                    <div class="bg-orange-50 p-4 rounded-xl border-l-4 border-orange-500">
                        <h3 class="font-bold text-orange-700 mb-2">💧 조리법</h3>
                        <p class="text-orange-800">끓는 물 550ml에 면과 스프를 넣고 4분간 끓여주세요.</p>
                    </div>

                    <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-purple-500">
                        <h3 class="font-bold text-purple-700 mb-2">🌾 알레르기 정보</h3>
                        <p class="text-purple-800 mb-2"><strong>함유 알레르기 성분:</strong> 밀, 대두</p>
                        <p class="text-purple-800 mb-2"><strong>주의사항:</strong> 밀가루나 대두 알레르기가 있는 분은 섭취를 피해주세요.</p>
                        <p class="text-purple-800 text-sm">※ 이 제품은 계란, 우유, 새우를 사용한 제품과 같은 제조시설에서 생산됩니다.</p>
                    </div>
                </div>

                <button onclick="speakDetailSection('warning')" class="w-full mt-6 bg-yellow-600 hover:bg-yellow-700 text-white py-4 rounded-2xl font-bold text-lg transition-all duration-300 shadow-lg">
                    🔊 음성으로 듣기
                </button>
            </div>
        </div>
    </div>

    <!-- 전체 정보 페이지 -->
    <div id="allInfoPage" class="page">
        <div class="container mx-auto px-4 py-6 max-w-md">
            <div class="flex items-center mb-6">
                <button onclick="showMainPage()" class="mr-4 p-2 rounded-full bg-white shadow-lg">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <h1 class="text-2xl font-bold text-gray-800">📋 전체 정보</h1>
            </div>

            <div class="space-y-4">
                <!-- 제품 기본 정보 -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">🛒</span>
                        제품 정보
                    </h3>
                    <div class="space-y-2 text-gray-700">
                        <p><strong>제품명:</strong> 진라면 매운맛</p>
                        <p><strong>용량:</strong> 120g (컵라면)</p>
                        <p><strong>제조사:</strong> 오뚜기 주식회사</p>
                        <p><strong>제조일:</strong> 2024년 12월 10일</p>
                    </div>
                </div>

                <!-- 보관방법 -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">🧊</span>
                        보관방법
                    </h3>
                    <div class="space-y-2 text-gray-700">
                        <p>• 직사광선을 피해 서늘하고 건조한 곳에 보관</p>
                        <p>• 습기가 많은 곳 보관 금지</p>
                        <p>• 개봉 후 즉시 조리하여 섭취</p>
                        <p>• 실온보관 가능</p>
                    </div>
                </div>

                <!-- 소비자상담실 -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">📞</span>
                        소비자상담실
                    </h3>
                    <div class="space-y-2 text-gray-700">
                        <p><strong>전화번호:</strong> 080-023-8888</p>
                        <p><strong>운영시간:</strong> 평일 09:00~18:00</p>
                        <p><strong>이메일:</strong> cs@ottogi.co.kr</p>
                        <p><strong>홈페이지:</strong> www.ottogi.co.kr</p>
                    </div>
                </div>

                <!-- 제조사 정보 -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">🏭</span>
                        제조사 정보
                    </h3>
                    <div class="space-y-2 text-gray-700">
                        <p><strong>회사명:</strong> 오뚜기 주식회사</p>
                        <p><strong>주소:</strong> 경기도 안양시 동안구 흥안대로 405</p>
                        <p><strong>사업자등록번호:</strong> 138-81-00011</p>
                        <p><strong>식품제조업 신고번호:</strong> 제1978-0001호</p>
                    </div>
                </div>

                <!-- 인증 정보 -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-2">🏆</span>
                        인증 정보
                    </h3>
                    <div class="space-y-2 text-gray-700">
                        <p>• HACCP 인증 (식품안전관리인증)</p>
                        <p>• ISO 22000 인증</p>
                        <p>• KS 인증 (한국산업표준)</p>
                        <p>• 할랄 인증</p>
                    </div>
                </div>

                <button onclick="speakDetailSection('all')" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-4 rounded-2xl font-bold text-lg transition-all duration-300 shadow-lg">
                    🔊 전체 정보 음성으로 듣기
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentSpeech = null;
        let isSpeaking = false;
        let recognition = null;
        let isListening = false;
        let speechStartTime = 0; // 음성 시작 시간 추적
        let originalText = ''; // 원본 텍스트 저장

        const mainPlayBtn = document.getElementById('mainPlayBtn');
        const playIcon = document.getElementById('playIcon');
        const stopIcon = document.getElementById('stopIcon');
        const speakingIndicator = document.getElementById('speakingIndicator');
        const speedControl = document.getElementById('speedControl');

        // 음성인식 초기화 - 완전히 새로운 안정적인 방식
        function initSpeechRecognition() {
            console.log('🎤 음성인식 초기화 시작...');
            
            // 브라우저 지원 확인
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                console.log('❌ 이 브라우저는 음성인식을 지원하지 않습니다.');
                showStatus('❌ 이 브라우저는 음성인식을 지원하지 않습니다.', 'error');
                return false;
            }

            try {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                // 단순하고 안정적인 설정
                recognition.lang = 'ko-KR';
                recognition.continuous = false; // 연속 모드 비활성화로 안정성 향상
                recognition.interimResults = false; // 중간 결과 비활성화로 성능 향상
                recognition.maxAlternatives = 1;
                
                let isProcessing = false;
                
                recognition.onstart = function() {
                    isListening = true;
                    showListeningIndicator();
                    console.log('✅ 음성인식 시작됨');
                    showStatus('✅ 음성인식 활성화! "얌인포"라고 말해보세요', 'success', 3000);
                };
                
                recognition.onresult = function(event) {
                    if (isProcessing) return;
                    isProcessing = true;
                    
                    let transcript = '';
                    for (let i = 0; i < event.results.length; i++) {
                        transcript += event.results[i][0].transcript;
                    }
                    
                    transcript = transcript.toLowerCase().trim();
                    console.log('🔊 인식된 음성:', transcript);
                    
                    if (transcript.length > 1) {
                        // 호출어 감지 - 더 관대한 매칭
                        const triggerWords = ['얌인포', '얌 인포', '알리미', '얌', '인포', '야민포', '얌 인 포'];
                        const hasTrigger = triggerWords.some(word => transcript.includes(word));
                        
                        if (hasTrigger) {
                            console.log('✅ 호출어 감지됨!');
                            handleVoiceCommand(transcript);
                        } else {
                            console.log('⚠️ 호출어 없음:', transcript);
                            showStatus(`인식됨: "${transcript}" - "얌인포"라고 말해주세요`, 'warning', 2000);
                        }
                    }
                    
                    // 처리 완료 후 자동 재시작
                    setTimeout(() => {
                        isProcessing = false;
                        if (!isSpeaking) {
                            startListening();
                        }
                    }, 1000);
                };
                
                recognition.onerror = function(event) {
                    console.log('❌ 음성인식 오류:', event.error);
                    isProcessing = false;
                    
                    let errorMessage = '';
                    let shouldRestart = true;
                    
                    switch(event.error) {
                        case 'not-allowed':
                            errorMessage = '마이크 권한이 거부되었습니다. 브라우저 설정에서 마이크를 허용해주세요.';
                            shouldRestart = false;
                            break;
                        case 'no-speech':
                            errorMessage = '음성이 감지되지 않았습니다. 다시 시도합니다.';
                            shouldRestart = true;
                            break;
                        case 'audio-capture':
                            errorMessage = '마이크에 접근할 수 없습니다. 다른 앱을 종료해주세요.';
                            shouldRestart = false;
                            break;
                        case 'network':
                            errorMessage = '네트워크 오류입니다. 연결을 확인해주세요.';
                            shouldRestart = true;
                            break;
                        default:
                            errorMessage = `오류: ${event.error}`;
                            shouldRestart = true;
                    }
                    
                    showStatus(errorMessage, 'error', 3000);
                    hideListeningIndicator();
                    
                    // 자동 재시작
                    if (shouldRestart && !isSpeaking) {
                        setTimeout(() => {
                            startListening();
                        }, 2000);
                    }
                };
                
                recognition.onend = function() {
                    isListening = false;
                    hideListeningIndicator();
                    console.log('🔇 음성인식 종료됨');
                    
                    // 음성 재생 중이 아니면 자동 재시작
                    if (!isSpeaking && !isProcessing) {
                        setTimeout(() => {
                            startListening();
                        }, 500);
                    }
                };
                
                console.log('✅ 음성인식 초기화 완료');
                return true;
                
            } catch (error) {
                console.log('❌ 음성인식 초기화 오류:', error);
                showStatus('❌ 음성인식을 초기화할 수 없습니다.', 'error');
                return false;
            }
        }

        // 상태 메시지 표시 함수
        function showStatus(message, type = 'info', duration = 5000) {
            const statusDiv = document.getElementById('microphoneStatus');
            if (!statusDiv) return;
            
            statusDiv.classList.remove('hidden');
            
            let colorClass = 'text-blue-600';
            if (type === 'error') colorClass = 'text-red-600';
            else if (type === 'success') colorClass = 'text-green-600';
            else if (type === 'warning') colorClass = 'text-yellow-600';
            
            statusDiv.innerHTML = `<p class="${colorClass}">${message}</p>`;
            
            if (duration > 0) {
                setTimeout(() => {
                    statusDiv.classList.add('hidden');
                }, duration);
            }
        }

        // 음성인식 시작 함수 - 단순하고 안정적인 방식
        function startListening() {
            if (!recognition) {
                console.log('❌ 음성인식이 초기화되지 않았습니다.');
                showStatus('❌ 음성인식이 초기화되지 않았습니다.', 'error');
                return;
            }
            
            if (isListening) {
                console.log('⚠️ 이미 음성인식이 실행 중입니다.');
                return;
            }
            
            if (isSpeaking) {
                console.log('⚠️ 음성 재생 중이므로 인식을 시작하지 않습니다.');
                return;
            }
            
            try {
                console.log('🎤 음성인식 시작 시도...');
                recognition.start();
            } catch (error) {
                console.log('❌ 음성인식 시작 오류:', error);
                
                if (error.name === 'InvalidStateError') {
                    // 이미 실행 중인 경우 잠시 후 재시도
                    setTimeout(() => {
                        if (!isListening) {
                            startListening();
                        }
                    }, 1000);
                } else {
                    showStatus('❌ 음성인식을 시작할 수 없습니다. 마이크 권한을 확인해주세요.', 'error');
                }
            }
        }

        // 마이크 테스트 함수 - 단순하고 직관적인 방식
        async function testMicrophone() {
            showStatus('🎤 마이크 테스트를 시작합니다...', 'info');
            
            try {
                // 마이크 권한 요청 및 접근
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: true
                });
                
                showStatus('✅ 마이크 접근 성공! 3초간 "안녕하세요"라고 말해보세요', 'success');
                
                // 3초 후 스트림 정리
                setTimeout(() => {
                    stream.getTracks().forEach(track => track.stop());
                    showStatus('✅ 마이크 테스트 완료! 이제 "얌인포"라고 말해보세요', 'success', 3000);
                    
                    // 음성인식 재시작
                    setTimeout(() => {
                        if (!isListening) {
                            startListening();
                        }
                    }, 1000);
                }, 3000);
                
            } catch (error) {
                console.log('마이크 접근 오류:', error);
                
                let errorMessage = '';
                let solution = '';
                
                switch(error.name) {
                    case 'NotAllowedError':
                        errorMessage = '❌ 마이크 권한이 거부되었습니다';
                        solution = '브라우저 주소창 왼쪽의 🔒 아이콘을 클릭하여 마이크를 허용해주세요';
                        break;
                    case 'NotFoundError':
                        errorMessage = '❌ 마이크를 찾을 수 없습니다';
                        solution = '마이크가 연결되어 있는지 확인해주세요';
                        break;
                    case 'NotReadableError':
                        errorMessage = '❌ 마이크에 접근할 수 없습니다';
                        solution = '다른 앱에서 마이크를 사용 중일 수 있습니다. 다른 앱을 종료해주세요';
                        break;
                    default:
                        errorMessage = `❌ 오류: ${error.message || error.name}`;
                        solution = '페이지를 새로고침하거나 다른 브라우저를 사용해보세요';
                }
                
                showStatus(`${errorMessage}. ${solution}`, 'error', 8000);
            }
        }
        


        // 음성인식 강제 재시작 함수
        function restartListening() {
            showStatus('🔄 음성인식을 다시 시작합니다...', 'info');
            
            if (recognition) {
                try {
                    recognition.stop();
                } catch (e) {
                    console.log('정지 중 오류:', e);
                }
                
                setTimeout(() => {
                    isListening = false;
                    startListening();
                    showStatus('✅ 음성인식이 다시 시작되었습니다!', 'success', 2000);
                }, 1000);
            } else {
                showStatus('❌ 음성인식을 초기화할 수 없습니다.', 'error', 3000);
            }
        }

        // 인식할 명령어와 실행할 동작을 연결하는 객체
        const commandMap = {
            '유통기한': 'expiry',
            '원재료': 'ingredients',
            '원재료명': 'ingredients',
            '영양정보': 'nutrition',
            '주의사항': 'warning',
            '전체 정보': 'all',
            '전부': 'all',
            '모든 정보': 'all',
            '전체': 'all'
        };

        // 음성 명령 처리 - 알리미 호출어 지원
        function handleVoiceCommand(transcript) {
            console.log('🎯 명령 처리 중:', transcript);
            
            // 음성인식 일시 정지
            if (recognition && isListening) {
                recognition.stop();
            }
            
            let response = '';
            let shouldSpeak = true;
            let command = '';
            
            // "알리미" 또는 "얌인포" 호출어 제거하고 명령어 추출
            if (transcript.includes('알리미')) {
                command = transcript.replace(/알리미\s*/, '').trim();
            } else if (transcript.includes('얌인포')) {
                command = transcript.replace(/얌인포\s*/, '').trim();
            } else {
                command = transcript.trim();
            }
            
            console.log('처리할 명령어:', command);
            
            // 명령어 매핑 확인
            if (command) {
                // 명령어와 일치하는 키워드 찾기
                const normalizedCommand = Object.keys(commandMap).find(key => command.includes(key));
                
                if (normalizedCommand) {
                    const pageId = commandMap[normalizedCommand];
                    console.log('실행할 페이지:', pageId);
                    
                    // 페이지 이동 및 음성 안내
                    switch(pageId) {
                        case 'expiry':
                            response = generateDetailSpeechText('expiry');
                            showDetailPage('expiry');
                            console.log('📅 유통기한 정보 요청');
                            break;
                        case 'ingredients':
                            response = generateDetailSpeechText('ingredients');
                            showDetailPage('ingredients');
                            console.log('📋 원재료 정보 요청');
                            break;
                        case 'nutrition':
                            response = generateDetailSpeechText('nutrition');
                            showDetailPage('nutrition');
                            console.log('📊 영양정보 요청');
                            break;
                        case 'warning':
                            response = generateDetailSpeechText('warning');
                            showDetailPage('warning');
                            console.log('⚠️ 주의사항 요청');
                            break;
                        case 'all':
                            response = generateDetailSpeechText('all');
                            showDetailPage('all');
                            console.log('📋 전체정보 요청');
                            break;
                    }
                } else {
                    // 기존 명령어 처리 로직
                    if (command.includes('메인') || command.includes('처음') || command.includes('홈') || command.includes('돌아가')) {
                        showMainPage();
                        response = '메인 페이지로 돌아갑니다.';
                        console.log('🏠 메인페이지 요청');
                    } else if (command.includes('정지') || command.includes('멈춰') || command.includes('그만') || command.includes('스톱')) {
                        stopSpeech();
                        shouldSpeak = false;
                        console.log('⏹️ 음성 정지 요청');
                    } else if (command.includes('빨리') || command.includes('빠르게') || command.includes('속도')) {
                        const newSpeed = Math.min(1.0, parseFloat(speedControl.value) + 0.1);
                        speedControl.value = newSpeed;
                        // 속도 표시 업데이트
                        const speedValue = document.getElementById('speedValue');
                        if (speedValue) {
                            speedValue.textContent = `현재: ${newSpeed}배속`;
                        }
                        response = `음성 속도를 ${newSpeed}배속으로 빠르게 조정했습니다.`;
                        console.log('⚡ 속도 증가 요청');
                    } else if (command.includes('천천히') || command.includes('느리게')) {
                        const newSpeed = Math.max(0.6, parseFloat(speedControl.value) - 0.1);
                        speedControl.value = newSpeed;
                        // 속도 표시 업데이트
                        const speedValue = document.getElementById('speedValue');
                        if (speedValue) {
                            speedValue.textContent = `현재: ${newSpeed}배속`;
                        }
                        response = `음성 속도를 ${newSpeed}배속으로 느리게 조정했습니다.`;
                        console.log('🐌 속도 감소 요청');
                    } else if (command.includes('안녕') || command.includes('헬로') || command.includes('하이')) {
                        response = '안녕하세요! 얌인포입니다. 유통기한, 원재료, 영양정보, 주의사항 중 무엇을 알고 싶으신가요?';
                        console.log('👋 인사 요청');
                    } else {
                        // 명령을 이해하지 못했을 때
                        response = '죄송합니다. 명령을 이해하지 못했습니다. 유통기한, 원재료, 영양정보, 주의사항, 전체정보 중 하나를 말씀해주세요.';
                        console.log('❓ 명령 이해 실패:', command);
                    }
                }
            } else {
                // 호출어만 있고 명령어가 없을 때
                response = '네, 얌인포입니다! 유통기한, 원재료, 영양정보, 주의사항, 전체정보 중 무엇을 알고 싶으신가요?';
                console.log('❓ 일반 응답');
            }
            
            if (shouldSpeak && response) {
                // 현재 재생 중인 음성이 있으면 정지
                if (isSpeaking) {
                    stopSpeech();
                }
                
                // 응답 재생
                setTimeout(() => {
                    startSpeech(response);
                }, 300);
            }
        }

        // 음성인식 상태 표시
        function showListeningIndicator() {
            const indicator = document.getElementById('listeningIndicator');
            if (indicator) {
                indicator.classList.remove('hidden');
            }
        }

        function hideListeningIndicator() {
            const indicator = document.getElementById('listeningIndicator');
            if (indicator) {
                indicator.classList.add('hidden');
            }
        }

        // 페이지 전환 함수
        function showDetailPage(section) {
            document.getElementById('mainPage').classList.remove('active');
            
            let targetPage;
            switch(section) {
                case 'expiry':
                    targetPage = 'expiryPage';
                    break;
                case 'ingredients':
                    targetPage = 'ingredientsPage';
                    break;
                case 'nutrition':
                    targetPage = 'nutritionPage';
                    break;
                case 'warning':
                    targetPage = 'warningPage';
                    break;
                case 'all':
                    targetPage = 'allInfoPage';
                    break;
            }
            
            document.getElementById(targetPage).classList.add('active', 'slide-in');
        }

        function showMainPage() {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active', 'slide-in');
            });
            document.getElementById('mainPage').classList.add('active');
        }

        // 전체 상품 정보 텍스트 생성
        function generateFullSpeechText() {
            const productName = document.getElementById('productName').textContent;
            const expiryDate = document.getElementById('expiryDate').textContent;
            const ingredients = document.getElementById('ingredients').textContent;

            return `
                안녕하세요. ${productName} 정보를 안내해드리겠습니다. 
                
                유통기한은 이천이십오년 십이월 십오일까지입니다. 
                
                원재료는 면에는 밀가루와 팜유가, 스프에는 고춧가루와 마늘이 들어있습니다. 
                
                영양정보는 한 개당 칼로리 오백십킬로칼로리, 단백질 구점팔그램, 지방 십구점이그램이 들어있습니다.
                
                주의사항은 직사광선을 피해 보관하시고, 끓는 물에 조리할 때 화상에 주의하세요. 알레르기 성분으로 밀과 대두가 함유되어 있습니다.
                
                각 정보를 자세히 보시려면 해당 칸을 터치해주세요.
            `;
        }

        // 상세 섹션별 음성 텍스트 생성
        function generateDetailSpeechText(section) {
            switch(section) {
                case 'expiry':
                    return `유통기한 정보를 안내해드리겠습니다. 이 제품의 유통기한은 이천이십오년 구월 삼십일까지입니다. 제조일자는 이천이십오년 구월 이십오일이며, 제조일로부터 5일간 신선하게 드실 수 있습니다. 냉장고 4도 이하에서 보관하시고, 개봉 후에는 3일 이내에 드세요.`;
                    
                case 'ingredients':
                    return `원재료 정보를 안내해드리겠습니다. 이 제품은 유기농 원유 100퍼센트로 만들어졌으며, 모두 국내산입니다. 국가 유기농 인증을 받은 목장에서 생산된 원유만을 사용하며, 항생제와 성장호르몬을 사용하지 않아 안전하게 생산되었습니다.`;
                    
                case 'nutrition':
                    return `영양정보를 자세히 안내해드리겠습니다. 100밀리리터당 칼로리는 67킬로칼로리, 단백질 3.2그램, 지방 3.8그램, 탄수화물 4.7그램이 들어있습니다. 또한 칼슘 113밀리그램과 나트륨 44밀리그램이 포함되어 있어 영양가가 풍부합니다.`;
                    
                case 'warning':
                    return `주의사항을 안내해드리겠습니다. 냉장고 4도 이하에서 보관해주시고, 개봉 후에는 3일 이내에 섭취해주세요. 가열하실 때는 끓이지 마시고 60도 이하로 데워서 드세요. 알레르기 정보를 말씀드리면, 이 제품에는 우유가 함유되어 있으며, 우유를 사용한 제품과 같은 제조시설에서 생산됩니다. 유제품 알레르기가 있는 분은 섭취를 피해주시기 바랍니다.`;
                    
                case 'all':
                    return `전체 정보를 안내해드리겠습니다. 프리미엄 유기농 우유 1000밀리리터 제품입니다. 자연목장 주식회사에서 제조하였으며, 소비자상담실 전화번호는 1588-1234번입니다. 평일 오전 9시부터 오후 6시까지 운영합니다. 냉장고 4도 이하에서 보관하시고, 직사광선을 피해 서늘한 곳에 보관해주세요. 유기농 인증과 해썹 인증을 받은 안전한 제품입니다.`;
                    
                default:
                    return generateFullSpeechText();
            }
        }

        // 음성 재생 함수
        function startSpeech(text = null) {
            if ('speechSynthesis' in window) {
                const speechText = text || generateFullSpeechText();
                originalText = speechText; // 원본 텍스트 저장
                currentSpeech = new SpeechSynthesisUtterance(speechText);
                
                // 한국어 설정 - 부드러운 음성
                currentSpeech.lang = 'ko-KR';
                currentSpeech.rate = parseFloat(speedControl.value);
                currentSpeech.pitch = 0.9;
                currentSpeech.volume = 0.9;

                // 음성 시작 이벤트
                currentSpeech.onstart = function() {
                    isSpeaking = true;
                    speechStartTime = Date.now(); // 시작 시간 기록
                    if (playIcon && stopIcon) {
                        playIcon.classList.add('hidden');
                        stopIcon.classList.remove('hidden');
                        mainPlayBtn.classList.add('speaking');
                    }
                    if (speakingIndicator) {
                        speakingIndicator.classList.remove('hidden');
                    }
                };

                // 음성 종료 이벤트
                currentSpeech.onend = function() {
                    resetSpeechControls();
                };

                // 음성 에러 이벤트
                currentSpeech.onerror = function() {
                    resetSpeechControls();
                    alert('음성 재생 중 오류가 발생했습니다. 다시 시도해주세요.');
                };

                speechSynthesis.speak(currentSpeech);
            } else {
                alert('이 브라우저는 음성 기능을 지원하지 않습니다.');
            }
        }

        // 음성 정지 함수
        function stopSpeech() {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            resetSpeechControls();
        }

        // 컨트롤 초기화
        function resetSpeechControls() {
            isSpeaking = false;
            if (playIcon && stopIcon) {
                playIcon.classList.remove('hidden');
                stopIcon.classList.add('hidden');
                mainPlayBtn.classList.remove('speaking');
            }
            if (speakingIndicator) {
                speakingIndicator.classList.add('hidden');
            }
        }

        // 상세 섹션 음성 재생
        function speakDetailSection(section) {
            if (isSpeaking) {
                stopSpeech();
            }
            const text = generateDetailSpeechText(section);
            startSpeech(text);
        }

        // 메인 버튼 이벤트
        if (mainPlayBtn) {
            mainPlayBtn.addEventListener('click', function() {
                if (isSpeaking) {
                    stopSpeech();
                } else {
                    startSpeech();
                }
            });
        }

        // 음성 속도 실시간 변경 - 현재 위치부터 이어서 재생
        let speedChangeTimeout = null;
        let lastSpeedChange = 0;
        let currentTextPosition = 0; // 현재 재생 위치 추적
        let estimatedWordsPerSecond = 3; // 초당 단어 수 (한국어 기준)
        
        if (speedControl) {
            // 속도 표시 업데이트 함수
            function updateSpeedDisplay() {
                const speedValue = document.getElementById('speedValue');
                if (speedValue) {
                    speedValue.textContent = `현재: ${speedControl.value}배속`;
                }
            }
            
            speedControl.addEventListener('input', function() {
                const newRate = parseFloat(speedControl.value);
                updateSpeedDisplay(); // 실시간 표시 업데이트
                
                if (currentSpeech && isSpeaking) {
                    // 기존 타이머 취소
                    if (speedChangeTimeout) {
                        clearTimeout(speedChangeTimeout);
                    }
                    
                    // 현재 시간 기록
                    lastSpeedChange = Date.now();
                    
                    // 즉시 속도 변경 시도 (Chrome, Edge에서 지원)
                    try {
                        currentSpeech.rate = newRate;
                        console.log('속도 즉시 변경:', newRate);
                    } catch (error) {
                        console.log('즉시 속도 변경 불가:', error);
                    }
                    
                    // 300ms 후에도 변경이 반영되지 않았다면 현재 위치부터 재시작
                    speedChangeTimeout = setTimeout(() => {
                        // 사용자가 계속 조절 중이면 대기
                        if (Date.now() - lastSpeedChange < 250) {
                            return;
                        }
                        
                        if (currentSpeech && isSpeaking && originalText) {
                            // 현재 재생 위치 계산 (경과 시간 기반)
                            const elapsedTime = (Date.now() - speechStartTime) / 1000;
                            const currentRate = currentSpeech.rate || 0.8;
                            const wordsSpoken = elapsedTime * estimatedWordsPerSecond * currentRate;
                            
                            // 텍스트를 단어 단위로 분할
                            const words = originalText.split(/\s+/);
                            const currentWordIndex = Math.floor(Math.min(wordsSpoken, words.length - 1));
                            
                            // 현재 위치부터 남은 텍스트 추출 (조금 앞에서부터 다시 시작)
                            const backtrackWords = Math.min(5, currentWordIndex); // 최대 5단어 뒤로
                            const startIndex = Math.max(0, currentWordIndex - backtrackWords);
                            const remainingText = words.slice(startIndex).join(' ');
                            
                            console.log(`현재 위치: ${currentWordIndex}/${words.length} 단어, ${backtrackWords}단어 뒤에서 재시작, 남은 텍스트 길이: ${remainingText.length}`);
                            
                            // 남은 텍스트가 충분히 있을 때만 재시작
                            if (remainingText.length > 10) {
                                // 부드러운 페이드아웃
                                const fadeSteps = 3;
                                let currentStep = 0;
                                const originalVolume = currentSpeech.volume;
                                
                                const fadeOut = setInterval(() => {
                                    currentStep++;
                                    const newVolume = originalVolume * (1 - currentStep / fadeSteps);
                                    try {
                                        currentSpeech.volume = Math.max(0, newVolume);
                                    } catch (e) {}
                                    
                                    if (currentStep >= fadeSteps) {
                                        clearInterval(fadeOut);
                                        
                                        // 현재 음성 정지
                                        speechSynthesis.cancel();
                                        
                                        // 남은 텍스트로 새로운 속도로 재시작
                                        setTimeout(() => {
                                            currentSpeech = new SpeechSynthesisUtterance(remainingText);
                                            currentSpeech.lang = 'ko-KR';
                                            currentSpeech.rate = newRate;
                                            currentSpeech.pitch = 0.9;
                                            currentSpeech.volume = originalVolume;
                                            
                                            // 새로운 시작 시간 설정
                                            speechStartTime = Date.now();
                                            
                                            currentSpeech.onstart = function() {
                                                isSpeaking = true;
                                                if (playIcon && stopIcon) {
                                                    playIcon.classList.add('hidden');
                                                    stopIcon.classList.remove('hidden');
                                                    mainPlayBtn.classList.add('speaking');
                                                }
                                                if (speakingIndicator) {
                                                    speakingIndicator.classList.remove('hidden');
                                                }
                                            };

                                            currentSpeech.onend = function() {
                                                resetSpeechControls();
                                            };

                                            currentSpeech.onerror = function() {
                                                resetSpeechControls();
                                            };
                                            
                                            speechSynthesis.speak(currentSpeech);
                                        }, 5); // 최소 지연
                                    }
                                }, 15); // 빠른 페이드아웃
                            } else {
                                // 남은 텍스트가 적으면 속도만 변경
                                try {
                                    currentSpeech.rate = newRate;
                                } catch (e) {}
                            }
                        }
                    }, 300); // 0.3초 후 재시작 (더 빠른 반응)
                }
            });
            
            // 초기 속도 표시
            updateSpeedDisplay();
        }

        // 페이지 로드 시 음성인식 초기화 및 자동 시작
        window.addEventListener('load', function() {
            // 음성인식 초기화
            if (initSpeechRecognition()) {
                console.log('✅ YumInfo가 준비되었습니다.');
                // 2초 후 자동으로 음성인식 시작
                setTimeout(() => {
                    startListening();
                    console.log('🎤 음성인식이 자동으로 시작되었습니다. "얌인포"라고 불러주세요!');
                }, 2000);
            }
        });

        // 키보드 접근성 (스페이스바로 재생/정지)
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space' && e.target.tagName !== 'INPUT') {
                e.preventDefault();
                if (isSpeaking) {
                    stopSpeech();
                } else {
                    startSpeech();
                }
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98281bd43002ea2b',t:'MTc1ODQ0MjQ2My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
